# We use Marshall Lochbaum's csv parser from bqnlibs
# Edit the following line with the correct path:
bqnlibs â† "/home/omar/code/bqn-libs/"

csv â‡ âŸ¨""";"âˆ¾@+10âŸ© â€¢Import bqnlibs â€¢file.At "csv.bqn"

DL â‡ {
 â€¢file.CreateDirâŠ@ "data"
 y â† â€¢Fmt ğ•©
 âŠ‘â€¢SH âŸ¨"wget", "-O", "data/scimagojr_"âˆ¾yâˆ¾".csv",
       "https://www.scimagojr.com/journalrank.php?year="âˆ¾yâˆ¾"&type=all&out=xls"âŸ©
}

SJR â‡ {csv.Split Â¯1â†“â€¢file.Chars "data/scimagojr_"âˆ¾(â€¢Fmt ğ•©)âˆ¾".csv"}

Years â‡ {ğ•Š:âˆ§(â€¢ParseFloat 10â†“Â¯4â†“âŠ¢)Â¨("scimagojr_"â‰¡10âŠ¸â†‘)Â¨âŠ¸/â€¢file.List "data"}

MathJournals â‡ {
 fieldsâ€¿table â† (âŠ‘ â‹ˆ â‰âˆ˜>âˆ˜(1âŠ¸â†“)) SJR ğ•©
 [title, quartile, area] â† tableâŠËœfieldsâŠâŸ¨"Title", "Categories", "Areas"âŸ©
 math â† (âˆ¨Â´"Mathematics"âŠ¸â·)Â¨area
 mathâŠ¸/Ë˜ [title, quartile]
}

WriteMathCSV â‡ {ğ•¤
 mj â† MathJournalsÂ¨ y â† Years@
 all â† âˆ§ âˆ¾Â´ y {[t,q]â†ğ•© â‹„ â‰[t,(â‰ t)â¥Š<â€¢Fmt ğ•¨,q]}Â¨ mj
 "data/mathsjr.csv" â€¢file.Chars csv.Join all
}

EscapeQuotes â‡ {eâ†â‰ `'"'=sâ†(1+'"'=ğ•©)/ğ•©â‹„'\'Â¨âŒ¾(eâŠ¸/)s}
ElispString â‡ '"'âˆ¾'"'âˆ¾ËœEscapeQuotes

WriteMathElisp â‡ {ğ•¤
 mj â† MathJournalsÂ¨ y â† Years@
 all â† âˆ§ âˆ¾Â´ y {[t,q]â†ğ•© â‹„ â‰[t,(â‰ t)â¥Š<â€¢Fmt ğ•¨,q]}Â¨ mj
 lines â† ('('âˆ¾')'âˆ¾ËœâŠ¢)âˆ˜(1âŠ¸â†“âˆ˜âˆ¾' 'âŠ¸âˆ¾Â¨)âˆ˜(ElispStringÂ¨)Â¨ <Ë˜ all
 "data/mathsjr.lisp" â€¢file.Lines âŸ¨"("âŸ©âˆ¾linesâˆ¾âŸ¨")"âŸ©
 }
